# 서버 비용 최적화안 (월 50만 원대 목표)

## 개요
- **목표 예산**: 월 500,000원 이하
- **핵심 전략**: 단일 고사양 서버 대신 다목적 중간 사양 서버 1대로 통합, Cloud DB 스펙 축소, 네트워크/스토리지 리소스 최소화
- **예상 총액**: **492,096원/월** (부가세 별도, 24시간 상시 가동 기준)

| 구성 요소 | 선택 사양 | 월 예상 비용 | 비고 |
|-----------|-----------|--------------|------|
| 통합 애플리케이션 서버 | Standard G2, vCPU 8 · RAM 32GB, SSD 512GB | 263,232원 | Django API, Celery, 정적 자산, 모니터링까지 단일 Compose로 운영 |
| Cloud DB for MySQL (Managed) | vCPU 2 · RAM 8GB, SSD 200GB, 자동 백업 50GB | 193,600원 | 트랜잭션/보고서 부하를 고려한 최소 안정 스펙 |
| Object Storage (NAS 대체) | Object Storage Standard, 200GB | 19,200원 | 리포트·모델·LLM 로그 보관 (필요 용량 만큼 유연 확장) |
| 네트워크 & DNS | 공인 IP 1개, Global DNS 1건 | 8,064원 + 1,430원 | 외부 노출 서비스 한 개만 유지 |
| 보안 스캔/기타 | Trivy 스케줄 작업(서버 내 cron) | 0원 | 오픈소스 사용, 추가 요금 없음 |
| **합계** |  | **492,096원** |  |

> **비용 산정 기준**: 네이버 클라우드 서버 요금표(2024 Q1) On-Demand 단가 기준, 720시간(24시간 x 30일) 사용 시 시뮬레이션. 부가세, 아웃바운드 트래픽, 추가 백업 스토리지는 제외.

---

## 세부 구성 및 조정 내역

### 1. 통합 애플리케이션 서버
- **역할 통합**: 기존 2대(웹/API + 정적/대시보드) → 1대로 통합하여 Docker Compose로 서비스 격리.
- **사양 선택**: Standard G2 8vCPU/32GB/512GB SSD.
  - Django/DRF, Celery 워커, Redis, Nginx, 모니터링(Dozzle·cAdvisor)을 한 서버에서 컨테이너로 분리.
  - 야간/비성수기에는 Celery 워커 스케일을 1개로 줄여 CPU 사용량을 제어.
- **운영 전략**: 장애 대응을 위해 스냅샷을 주 1회 생성하고, 필요 시 동일 사양 서버를 1시간 내 복구.

### 2. Cloud DB for MySQL (Managed)
- **스펙 축소**: vCPU 4/16GB → vCPU 2/8GB로 다운스케일, 스토리지 1TB → 200GB.
  - 시뮬레이션 건수/거래 로그의 보존 기간을 3개월로 제한하고, 장기 데이터는 Object Storage로 이관.
  - 자동 백업 기간을 3일로 줄이고, 필요 시 중요 스냅샷을 Object Storage에 별도 저장.
- **비용 절약**: 관리형 DB를 유지해 운영 편의성 확보, 장애 시 수동 복구 시간을 줄여 가동률 확보.

### 3. Object Storage
- **도입 목적**: 기존 1TB SSD 대신 Object Storage로 리포트·모델·LLM 로그 보관.
- **비용 계산**: Standard 클래스 월 96원/GB 가정, 200GB 사용 시 19,200원.
- **운영 정책**: `reports`, `models`, `prompts` 버킷 사용, 6개월 우선 보관 후 Glacier급으로 이전(선택).

### 4. 네트워크·DNS
- **공인 IP**: 2개 → 1개. 모든 외부 트래픽을 Nginx Reverse Proxy로 수렴.
- **Global DNS**: 1건 유지. 도메인/서브도메인은 DNS 레코드로 관리.
- **내부 네트워크**: 애플리케이션 서버와 Managed DB 간 전용 VPC Peering 사용(추가 비용 없음).

### 5. 모니터링 & 보안
- **도구**: Prometheus/Grafana 대신 cAdvisor + Dozzle + CloudWatch Logs(선택) 등 경량 스택.
- **이미지 스캔**: Trivy를 서버 내부 cron으로 주 1회 실행해 CI/CD 비용을 줄임.
- **백업 전략 조정**: DB는 3일 자동 백업 + 주 1회 덤프(Object Storage). 애플리케이션 서버는 주 1회 스냅샷.

---

## 추가 절감 아이디어
1. **예약 인스턴스/선납 할인**: 1년 전용 요금제로 전환 시 약 15~20% 추가 절감 가능.
2. **근무 시간대 Auto-Scaling**: Celery 워커 컨테이너를 주간 2개 → 야간 1개로 조정.
3. **LLM 호출 빈도 관리**: 요금제 초과시 캐시·폴백 비율을 높여 외부 API 비용을 분기별로 검토.
4. **로그 샘플링**: 구조화 로그를 50% 샘플링으로 저장해 Object Storage 사용량을 제어.
5. **백업 주기 최적화**: 중요 데이터만 주 1회 전체 백업, 나머지는 증분 백업 스크립트로 대체.

---

## 문서 연계
- 기존 고사양 견적(`mdfiles/serverinit.md`)은 레퍼런스로 보관하고, 실제 운영 예산은 본 문서(`mdfiles/server.md`)를 기준으로 관리합니다.
- 주요 변경 사항은 `mdfiles/serverfeedback.md`에 반영하고, 예산 변동 시 본 문서를 업데이트합니다.
