# 서버 비용 최적화안 제안 (월 50만 원대 목표)

## 제안 개요
- **대상**: 기존 150만 원대 견적 대비 예산 축소가 필요한 상황
- **목표 예산**: 월 500,000원 이하
- **핵심 아이디어**: 단일 중간 사양 서버로 서비스 통합, Cloud DB 다운스케일, Object Storage 도입, 네트워크 리소스 최소화
- **예상 총액**: **약 492,096원/월** (부가세 제외, 24시간 가동 기준)

| 항목 | 제안 사양 | 월 예상 비용 | 비고 |
|------|-----------|--------------|------|
| 통합 애플리케이션 서버 | Standard G2, vCPU 8 · RAM 32GB, SSD 512GB | 263,232원 | Django API, Celery, 정적 자산, 모니터링 통합 |
| Cloud DB for MySQL | vCPU 2 · RAM 8GB, SSD 200GB, 자동 백업 50GB | 193,600원 | 보존 기간 3개월, 장기 데이터는 Object Storage 이전 |
| Object Storage | Standard 클래스 200GB | 19,200원 | 모델·리포트·LLM 로그 저장 |
| 네트워크 & DNS | 공인 IP 1개, Global DNS 1건 | 8,064원 + 1,430원 | 외부 노출은 Nginx 하나로 일원화 |
| 보안 스캔/기타 | Trivy cron 구동 | 0원 | 오픈소스 사용 |
| **합계** |  | **492,096원** |  |

> 단가 근거: 네이버 클라우드 2024년 Q1 On-Demand 가격표, 720시간 사용 시 산정. 트래픽·부가세·추가 백업은 제외.

---

## 서비스별 운영 전략 제안

### 1. 애플리케이션 서버 통합
- 웹/API, Celery 워커, Redis, Nginx, 모니터링을 Docker Compose로 컨테이너 분리.
- 야간에는 Celery 워커 수를 1대로 줄이고, 필요 시 `docker compose scale`로 수동 확장.
- 주간 장애 대비: 스냅샷 주 1회, 복구 스크립트 자동화.

### 2. Cloud DB 다운스케일
- vCPU 4 → 2, RAM 16GB → 8GB, 스토리지 1TB → 200GB.
- 거래 로그 보존 기간을 3개월로 제한하고, 월말에 Object Storage로 이전.
- 자동 백업 주기를 3일로 줄이고, 중요 시점은 수동 스냅샷을 Object Storage에 저장.

### 3. Object Storage 도입
- `reports`, `models`, `prompts` 버킷을 생성해 장기 보관.
- 6개월 이상 데이터는 Archive 클래스로 이전해 요금 추가 절감.
- MinIO 대신 네이버 Object Storage 사용 시 Outbound 트래픽 비용 검토.

### 4. 네트워크 최적화
- 공인 IP 1개만 유지, Nginx Reverse Proxy로 모든 외부 요청 처리.
- 내부 통신은 VPC Peering(추가 비용 없음)으로 DB와 연결.
- Dozzle, cAdvisor 등 모니터링 UI는 VPN 혹은 Bastion을 통해 제한적 접근.

### 5. 보안·운영 권장사항
- Trivy를 주 1회 cron으로 실행하고 결과를 Slack/Email로 알림.
- Celery 큐 길이, 실패 태스크 수, LLM 호출 오류를 Prometheus 대신 경량 스크립트로 체크.
- 백업: DB는 3일 자동 백업 + 주 1회 덤프(Object Storage), 애플리케이션 컨테이너는 `docker save`로 월 1회 보관.

### 단일 서버 구성의 장점과 유의점
- **장점**
  - **운영 단순화**: 하나의 호스트만 관리하면 되므로 배포 스크립트, 모니터링, 백업이 직관적이며 작업 동기화 이슈가 적습니다.
  - **비용 예측이 용이**: 고정 월 비용(약 49만 원) 안에서 CPU·메모리 크레딧을 모두 공유하므로 사용량 변동에 따른 추가 요금 리스크가 적습니다.
  - **네트워크 설계 간소화**: 공인 IP 1개, 보안 그룹/방화벽 규칙이 단순해져 운영 오류 가능성이 낮습니다.
  - **자원 활용 극대화**: 웹/API, 워커, 정적 빌드가 한 곳에서 자원을 공유해 피크 시간이 다르면 상호 보완이 가능합니다.
- **유의점**
  - 단일 장애 지점(SPOF)이므로 정기 스냅샷, 핫백업 스크립트 준비가 필수입니다.
  - 동시 부하가 높은 시점에는 CPU/메모리 경합이 발생할 수 있으므로 Celery/LLM 작업 스케줄링과 리소스 제한을 반드시 설정해야 합니다.

---

## 추가 절감 아이디어
1. 1년 예약 인스턴스(선납)로 전환 시 약 15~20% 추가 절감 가능.
2. 근무 시간대만 Celery 워커 추가 컨테이너를 올려 CPU 사용량을 제한.
3. LLM 호출 캐시·폴백 비율을 높여 외부 API 비용을 분기별로 조정.
4. 로그 샘플링(50%) 및 30일 이상 로그 압축 보관으로 Object Storage 비용 절감.
5. 모니터링/알림은 Slack Webhook 기반 경량 스크립트로 운영해 추가 SaaS 비용을 제거.

---

## 대안: 2대 분리 구성 (월 50만 원대 유지)
- **컨셉**: WAS/백엔드와 정적 자산 서버를 분리해 장애 격리와 확장성을 확보하면서도 월 50만 원대 예산을 유지하는 방안
- **합산 비용**: **약 419,414원/월** (부가세·트래픽 제외)

| 항목 | 제안 사양 | 월 예상 비용 | 비고 |
|------|-----------|--------------|------|
| WAS 서버 | Standard G2, vCPU 4 · RAM 16GB, SSD 200GB | 129,600원 | Django/DRF, Celery, Redis, 모니터링 실행 |
| 정적 자산 서버 | Standard G2, vCPU 2 · RAM 8GB, SSD 100GB | 69,120원 | Nginx, 정적 파일, 템플릿/차트 빌드, SSL 관리 |
| Cloud DB for MySQL | vCPU 2 · RAM 8GB, SSD 200GB, 자동 백업 50GB | 193,600원 | 연결 수 제한 고려, 보고서 쿼리 최적화 필요 |
| Object Storage | Standard 클래스 200GB | 19,200원 | 장기 리포트·모델·LLM 로그 저장 |
| 네트워크 & DNS | 공인 IP 2개, Global DNS 1건 | 8,064원 + 1,430원 | 외부 접근 지점 2개, 방화벽 규칙 이중 관리 |
| **합계** |  | **419,414원** | 스냅샷·추가 백업 시 소폭 증가 |

### 장점
- **장애 격리**: 정적 서버 장애가 API 가용성에 직접 영향 주지 않으며, 필요 시 정적 서버만 교체 가능.
- **확장 유연성**: 정적 자산/빌드 부하 증가 시 해당 서버만 스케일 업하거나 CDN 도입으로 대응 가능.
- **보안 경계 강화**: 외부 노출 지점을 Nginx 서버로 한정하고 WAS는 내부 VPC에서만 접근하도록 설정 가능.

### 단점 및 주의점
- **리소스 여유 부족**: WAS가 vCPU 4·RAM 16GB 수준이라 Celery 병렬 처리, LLM 후처리가 몰릴 때 병목 위험. 워커 수 조절과 스케줄링 필수.
- **운영 복잡도 증가**: 배포·모니터링·백업을 두 대에 대해 따로 수행해야 하며 공인 IP 관리도 추가됨.
- **비용 변동 리스크**: 트래픽·Object Storage 사용량이나 DNS 쿼리가 늘면 즉시 추가 비용이 발생.
- **배포 동기화 필요**: 정적 자산 빌드와 API 배포 일정이 다를 경우 릴리스 파이프라인 관리가 복잡해짐.

> **추천 활용 시점**: 단일 서버 구성이 과부하 징후를 보이거나 정적 빌드/캐시 작업이 WAS 성능을 저하시킬 때. 초기에는 단일 서버로 운영하며 모니터링 데이터가 누적된 뒤 전환하는 전략을 권장합니다.

---

## 후속 액션 제안
- 위 제안을 검토 후 채택 여부와 예산 변동 사항을 `mdfiles/server.md`에 명시해 주세요.
- 채택한 항목은 `mdfiles/serverfeedback.md` 하단에 “반영 완료” 메모를 남기고, 미채택 항목은 사유를 기록하면 향후 재검토가 수월합니다.
